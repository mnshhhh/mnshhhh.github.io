# 微信服务号H5页面登录实现

本项目实现了微信服务号H5页面的登录功能，包含微信授权跳转和登录页设计。

## 功能特性

1. **微信授权跳转**：支持snsapi_base模式的静默授权
2. **授权回调处理**：自动检测URL中的code参数并处理
3. **账号密码登录**：提供传统的账号密码登录方式
4. **微信一键登录**：提供快捷的微信登录按钮
5. **响应式设计**：适配各种移动设备屏幕
6. **状态反馈**：登录过程中的加载状态和提示信息

## 项目结构

```
/Users/bytedance/code/demo/
├── index.html       # 主登录页面
├── styles.css       # 样式文件
├── README.md        # 项目说明
└── home.html        # 登录成功后跳转页面（示例）
```

## 微信授权流程说明

1. **授权配置**：在 `index.html` 中配置微信公众号的 AppID 和回调域名
2. **授权触发**：用户访问页面时，会检查是否已有授权
3. **授权跳转**：如果没有授权，会重定向到微信授权页面
4. **回调处理**：授权成功后，微信会重定向回回调页面，并带上 code 参数
5. **获取用户信息**：前端获取 code 后，发送到后端换取用户信息

## 使用方法

### 1. 配置微信公众号

1. 在微信公众号后台配置授权回调域名（必须为已备案的域名）
2. 获取公众号的 AppID

### 2. 修改配置

在 `index.html` 文件中，找到 `WECHAT_CONFIG` 对象，修改以下内容：

```javascript
const WECHAT_CONFIG = {
    appId: 'wx1234567890abcdef',  // 替换为实际的公众号AppID
    redirectUri: encodeURIComponent('https://your-domain.com/demo/index.html'),  // 替换为实际的回调域名
    scope: 'snsapi_base'
};
```

### 3. 配置后端API

在 `handleWechatAuthSuccess` 函数中，修改后端API地址：

```javascript
const apiUrl = 'https://your-api.com/wechat/auth';
```

## 注意事项

1. **域名要求**：回调域名必须已备案，并且在微信公众号后台配置
2. **安全考虑**：代码中已加入 state 参数验证，防止CSRF攻击
3. **用户体验**：提供了账号密码登录作为备选方案
4. **测试环境**：建议在微信开发者工具中进行测试
5. **生产环境**：请确保在生产环境中替换为真实的配置信息

## 授权模式说明

本项目使用的是 `snsapi_base` 静默授权模式，该模式不会弹出授权确认页面，用户无感知，但只能获取用户的 openid。如果需要获取更多用户信息，请使用 `snsapi_userinfo` 模式。

## 开发说明

### 本地调试

1. 修改hosts文件，将本地开发环境映射到已备案域名
2. 使用nginx配置反向代理
3. 在微信开发者工具中测试

### 部署说明

1. 将项目文件上传到已备案的服务器
2. 确保服务器支持HTTPS
3. 在微信公众号后台配置正确的授权回调域名

## 浏览器兼容性

- 微信内置浏览器
- Chrome Mobile
- Safari Mobile
- Firefox Mobile

## 许可证

MIT